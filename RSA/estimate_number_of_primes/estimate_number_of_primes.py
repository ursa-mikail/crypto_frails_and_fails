from mpmath import riemannr
from decimal import Decimal, getcontext
import matplotlib.pyplot as plt

# Set decimal precision
getcontext().prec = 50


def estimate_primes_in_bit_range(bits: int) -> int:
    """Estimate number of primes between 2**(bits-1) and 2**bits."""
    upper = 2 ** bits
    lower = 2 ** (bits - 1)
    return int(riemannr(upper)) - int(riemannr(lower))


def estimate_prime_probability(bits: int) -> Decimal:
    """Estimate the probability (%) of randomly picking a prime in that bit range."""
    upper = Decimal(2 ** bits)
    lower = Decimal(2 ** (bits - 1))
    total_numbers = upper - lower
    estimated_primes = Decimal(estimate_primes_in_bit_range(bits))
    probability = (estimated_primes / total_numbers) * 100
    return probability.quantize(Decimal('0.01'))


def generate_probability_plot(start_bits: int = 128, end_bits: int = 2048, step: int = 128):
    """Generate and plot prime probability vs bit size, with detailed printouts."""
    bit_sizes = list(range(start_bits, end_bits + 1, step))
    probabilities = []

    print("Estimating number of primes and probabilities for each bit size:\n")

    for bits in bit_sizes:
        estimated_primes = estimate_primes_in_bit_range(bits)
        probability = estimate_prime_probability(bits)
        probabilities.append(float(probability))

        print(f"Number of bits in prime number:\t{bits}")
        print(f"Estimated number of prime numbers:\t{estimated_primes}")
        print(f"Chance of finding a prime:\t\t{probability} %\n")

    # Plotting
    plt.figure(figsize=(10, 6))
    plt.plot(bit_sizes, probabilities, marker='o', linestyle='-', color='blue')
    plt.title('Probability of Randomly Choosing a Prime Number by Bit Size')
    plt.xlabel('Bit Size')
    plt.ylabel('Probability (%)')
    plt.grid(True)
    plt.xticks(bit_sizes)
    plt.tight_layout()
    plt.show()


if __name__ == "__main__":
    generate_probability_plot(start_bits=128, end_bits=2048, step=128)

"""
Estimating number of primes and probabilities for each bit size:

Number of bits in prime number: 128
Estimated number of prime numbers:  1924335653748738171303310399098585088
Chance of finding a prime:      1.13 %

Number of bits in prime number: 256
Estimated number of prime numbers:  326840356080250821518508547915547565474508611197687121913382436676095180800
Chance of finding a prime:      0.56 %

Number of bits in prime number: 384
Estimated number of prime numbers:  74102500007058081541415341623941769154265143774086831208216869838293940149445523310990987256124418123380794851328
Chance of finding a prime:      0.38 %

Number of bits in prime number: 512
Estimated number of prime numbers:  18906370642694533330255267422559435438516148269380861172414282021437571915512683767157742768034244490543655250659082340701872652735175220791902826659840
Chance of finding a prime:      0.28 %

Number of bits in prime number: 640
Estimated number of prime numbers:  5145912424026871294546346559582601018180347389011144080904878343529200279932861135510054249671686655931211951633357661478156829934324730868500465793977997068292529438121881847652137843032064
Chance of finding a prime:      0.23 %

Number of bits in prime number: 768
Estimated number of prime numbers:  1459050970890306654978091697813797540808202681510378785181935424501658541119469012319488665195698348817524183523571275076210364906672801015019095784571099190618048001273790570663652232100906068060785903801558423475827511679516672
Chance of finding a prime:      0.19 %

Number of bits in prime number: 896
Estimated number of prime numbers:  425527195919866381895845783881617529488271190343309808542519818144865875028916600126799216891813748151599499881648939068894791113935836492429936510791050934847677161175330218695413459204128054621302619290126132470653439037850220749538410284967187874710365814715842560
Chance of finding a prime:      0.16 %

Number of bits in prime number: 1024
Estimated number of prime numbers:  126691644892970358380427490926939356454723247188496143392476652502699531007595837129481293240468742382467025120913518137109672918250221680859672250355250660838394556806299217183402234779768002807879623065822080202513999439628970955789026304528777698360560517487360234622406536447129531599628766639300804608
Chance of finding a prime:      0.14 %

Number of bits in prime number: 1152
Estimated number of prime numbers:  38318987057381742285746142751460698102485107335367343069435649425288785603462527367233237824823738483848267928066877132531774459624368500430964356149416995060172555715388512616977678865049472990715437014342637632967923879032182854519424870088532005625354190877961447347164067851997947234380988124100237749902028349851648040059110427687838023680
Chance of finding a prime:      0.13 %

Number of bits in prime number: 1280
Estimated number of prime numbers:  11734896789097255680530927790083035810370402619604457854196702126261941683397996551209191857530167076760311021827628334372025343010784452606264720846516968950641936752625220447162859228444578589046124893668259470503131516811598403050058520778198015090445395384309331823209677406117279339730635576909537791921442637578999391828889718838789561032805105343132913344778481718006747496448
Chance of finding a prime:      0.11 %

Number of bits in prime number: 1408
Estimated number of prime numbers:  3630048027152431150311973850809500737760356119458685735386107227620608347837111824312430980129263810920344292232147216721643765851635428402258781985638485469207592682838601340498627841954648249287570899578896257129035688295359425740809378685815269836507290752129058338421394637957435780788386698031933517201132008798025469053645819064510384495129693466597673295467602487010428851722351660730143744799629787544650501849088
Chance of finding a prime:      0.10 %

Number of bits in prime number: 1536
Estimated number of prime numbers:  1132274873130882881072665951975962028896866010401278921944075434443008516188596328291847041565182588761022353301386880988601688173807229101384564145569507010048178691958775520382256972173889016803383304300669212979572367621655075576029961206487932582438386486965158398761138537630251565999105433719377898275121288798412425727130911878783034715179787415038480045678710310767785407322822051083182262117809933727053577989338158881999282041321319991016725917204480
Chance of finding a prime:      0.09 %

Number of bits in prime number: 1664
Estimated number of prime numbers:  355647348514495196370686449029860227311692410000058574031089599821553232664708530507773667019470709073740131859577293352444944953523002694722133893787100799429027496174043197386252544126630358558506877616320350369632082328543881298695348397477624936686626879002225218667240190919042050631691354419017450819688317469554124380917248522307029722705492738811329853457365781909845119201814719250467291457973451234100598712101268279618259389835645125606781063282963310480053113346629975596763699323338752
Chance of finding a prime:      0.09 %

Number of bits in prime number: 1792
Estimated number of prime numbers:  112374062100974175645453235179982877094880839836187825394433549398053939907836600724763580329547662920074773205601012149054992656678241712575465279764350196645182540666976673116152522619692256678604131106928618823196807262687542906181246356375105228689562803313382501480133190415818841626390270280202892018334841298733002429501093812575088597851940263889145256584443271892149449841525858626266577819201008479264551502200963521604508866912649178262565985713340289735030829537564779670888575701105261507653621300535476836741548561315921920
Chance of finding a prime:      0.08 %

Number of bits in prime number: 1920
Estimated number of prime numbers:  35689063007310488406710762179469994044060837607899175525259911218384184851221762406827605635523562894405386961195072052041249689768968167754376014494368538625473230669235477164306883082275110834064942999496078726577141634765185148265296742145303259173352793139104227447573568721081334064752105695541106355169471450991770695667203072272822631977070642198056552359537473030838793563709407223981324607771102711032593700451164301304078787796911477972546152345119890422736588733197209011365801183695966087211490069695573053703915400294114861008461786235951291179740598671337586688
Chance of finding a prime:      0.08 %

Number of bits in prime number: 2048
Estimated number of prime numbers:  11385172270258672953764793456388645214256740287188220237389104580032209792659193924101416597006335941813038755260878001567334933908725291403697392808828239764599609819731878152305734495554617798558938055499227953935671432466474597689981539404264108325526516247781591774691266828619629734180673225660241271543591391989708758169413624895421128195230477399212718531210499701272562448816178087091221785420932500650269661768355526533958545122702304553518111237381614796970882146854046586446112589627992086028076057005913397168273375915681546605655773788353223659319186860982233577649003599445529974508879522956597788672
Chance of finding a prime:      0.07 %

"""